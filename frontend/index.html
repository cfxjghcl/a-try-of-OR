<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯å°±ä¸šå¯è§†åŒ–å¹³å°</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background: #f5f7fa; }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; }
        .chart-box { background: white; border-radius: 10px; padding: 20px; margin: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .chart { width: 100%; height: 400px; }
        .status { background: #e3f2fd; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .api-list { background: #f9f9f9; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .api-list code { background: #eee; padding: 2px 5px; border-radius: 3px; }
        .nav { text-align: center; margin: 20px 0; }
        .nav a { margin: 0 10px; color: #3498db; text-decoration: none; }
        .nav a:hover { text-decoration: underline; }
        .filter-box { background: white; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .filters { display: flex; flex-wrap: wrap; gap: 15px; }
        .filter-group { margin-bottom: 10px; }
        .filter-grouplabel { margin-right: 10px; font-weight: bold; }
        .filter-select, .filter-checkbox { margin-right: 15px; }
        .filter-btn { padding: 8px 15px; margin-right: 10px; border: none; border-radius: 5px; cursor: pointer; }
        .filter-btn:hover { opacity: 0.9; }
        .filter-btn.success { background-color: #4CAF50; color: white; }
        .filter-btn.secondary { background-color: #f0f0f0; color: #333; }
        .filter-btn.secondary:hover { opacity: 0.9; }
        .career-checkboxes label { display:flex; align-items:center; }
        .career-checkboxes { display: flex; flex-wrap: wrap; gap:10px; }
             
        </style>
</head>
<body>
    <h1>è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ä¸“ä¸šå°±ä¸šå¯è§†åŒ–å¹³å°</h1>
    
    <div class="nav">
        <a href=" ">é¦–é¡µ</a > | 
        <a href="/api/test-connection">æµ‹è¯•è¿æ¥</a > | 
        <a href="/api/health">å¥åº·æ£€æŸ¥</a > | 
        <a href="/api/tech_heat">æŠ€æœ¯çƒ­åº¦</a >
    </div>
    
    <div class="status">ğŸ“Š æ­£åœ¨åŠ è½½æ•°æ®...</div>
    
    <div class="api-list">
        <h3>å¯ç”¨APIæ¥å£ï¼š</h3>
        <ul>
            <li><code>GET /api/employment-trend</code> - å°±ä¸šè¶‹åŠ¿æ•°æ®</li> 
            <li><code>GET /api/salary-trend</code> - è–ªèµ„è¶‹åŠ¿æ•°æ®</li>
            <li><code>GET /api/wordcloud</code> - æŠ€æœ¯æ ˆè¯äº‘æ•°æ®</li>      
            <li><code>GET /api/tech_heat</code> - GitHubæŠ€æœ¯çƒ­åº¦</li>
            <li><code>GET /api/test-connection</code> - æµ‹è¯•è¿æ¥</li>
            <li><code>GET /api/health</code> - å¥åº·æ£€æŸ¥</li>
        </ul>
    </div>
    
    <div class="filter-box">
     <h3>ğŸ“Š æ•°æ®ç­›é€‰ä¸äº¤äº’</h3>
     <div class="filters">
         <div class="filter-group">
             <label for="yearRange">ğŸ“… å¹´ä»½èŒƒå›´ï¼š</label>
             <select id="yearRange" class="filter-select">
                 <option value="2020-2024">2020-2025(å…¨éƒ¨)</option>
                 <option value="2020-2022">2020-2022</option>
                 <option value="2023-2024">2023-2024</option>
                 <option value="2024-2025">2024-2025</option>
                 <option value="2025-2026">2025-2026</option>
             </select>
         </div>
        
         <div class="filter-group">
             <label>ğŸ‘¨â€ğŸ’» æ˜¾ç¤ºèŒä¸šï¼š</label>
             <div class="career-checkboxes">
                 <label><input type="checkbox" name="career" value="backend" checked> åç«¯å¼€å‘</label>
                 <label><input type="checkbox" name="career" value="frontend" checked> å‰ç«¯å¼€å‘</label>
                 <label><input type="checkbox" name="career" value="fullstack" checked> å…¨æ ˆå¼€å‘</label>
                 <label><input type="checkbox" name="career" value="data_science" checked> æ•°æ®ç§‘å­¦</label>
                 <label><input type="checkbox" name="career" value="ai_engineer" checked> AIå·¥ç¨‹å¸ˆ</label>
                 </div>
             </div>
        
             <div class="filter-group">
                 <label>ğŸ“ˆ å›¾è¡¨ç±»å‹ï¼š</label>
                 <select id="chartType" class="filter-select">
                     <option value="line">æŠ˜çº¿å›¾</option>
                     <option value="bar">æŸ±çŠ¶å›¾</option>
                     <option value="both">æŠ˜çº¿+æŸ±çŠ¶</option>
                 </select>
            </div>
        
             <button onclick="applyFilters()" class="filter-btn">åº”ç”¨ç­›é€‰</button>
             <button onclick="resetFilters()" class="filter-btn secondary">é‡ç½®</button>
             <button onclick="refreshData()" class="filter-btn success">ğŸ”„ åˆ·æ–°æ•°æ®</button>
         </div>
    </div>

    <div class="chart-box">
        <h3>å°±ä¸šç‡è¶‹åŠ¿ (2020-2025)</h3>
        <div id="employmentChart" class="chart"></div>
    </div>
    
    <div class="chart-box">
        <h3>å¹³å‡è–ªèµ„è¶‹åŠ¿ (2020-2025)</h3>
        <div id="salaryChart" class="chart"></div>
    </div>
    
    <div class="chart-box">
        <h3>çƒ­é—¨æŠ€æœ¯æ ˆè¯äº‘</h3>
        <div id="wordcloudChart" class="chart"></div>
    </div>
    
    <div class="chart-box">
        <h3>GitHubæŠ€æœ¯çƒ­åº¦æ’è¡Œ</h3>
        <div id="techHeatChart" class="chart"></div>
    </div>
    
    <script>
        const API_BASE = "";  
        
        console.log('å½“å‰APIåœ°å€:', API_BASE);
        
        // 1. è·å–å°±ä¸šæ•°æ® 
        fetch(API_BASE + '/api/employment-trend')
            .then(res => {
                console.log('å°±ä¸šAPIçŠ¶æ€ç :', res.status);
                if (!res.ok) {throw new Error('å°±ä¸šAPIè¯·æ±‚å¤±è´¥: ' + res.status);}
                return res.json();
            })
            .then(data => {
                console.log('å°±ä¸šæ•°æ®:', data);
                const chart = echarts.init(document.getElementById('employmentChart'));
                chart.setOption({
                    title: { text: 'å°±ä¸šç‡è¶‹åŠ¿ (%)' },
                    tooltip: { trigger: 'axis' },
                    xAxis: { type: 'category', data: data.years },
                    yAxis: { type: 'value', min: 80, max: 100, name: 'å°±ä¸šç‡(%)' },
                    legend: { data: ['åç«¯å¼€å‘', 'å‰ç«¯å¼€å‘', 'å…¨æ ˆå¼€å‘', 'æ•°æ®ç§‘å­¦', 'AIå·¥ç¨‹å¸ˆ'] },
                    series: [
                        { name: 'åç«¯å¼€å‘', type: 'line', data: data.backend },
                        { name: 'å‰ç«¯å¼€å‘', type: 'line', data: data.frontend },
                        { name: 'å…¨æ ˆå¼€å‘', type: 'line', data: data.fullstack },
                        { name: 'æ•°æ®ç§‘å­¦', type: 'line', data: data.data_science },
                        { name: 'AIå·¥ç¨‹å¸ˆ', type: 'line', data: data.ai_engineer }
                    ]
                });
                document.querySelector('.status').innerHTML = 'âœ… å°±ä¸šæ•°æ®åŠ è½½å®Œæˆ';
            })
            .catch(error => {
                console.error('è·å–å°±ä¸šæ•°æ®å¤±è´¥:', error);
                document.querySelector('.status').innerHTML = 'âŒ å°±ä¸šæ•°æ®åŠ è½½å¤±è´¥: ' + error.message;
            });
        
        // 2. è·å–è–ªèµ„æ•°æ®
        fetch(API_BASE + '/api/salary-trend')
            .then(res => {
                console.log('è–ªèµ„APIçŠ¶æ€ç :', res.status);
                if (!res.ok) {
                    throw new Error('è–ªèµ„APIè¯·æ±‚å¤±è´¥: ' + res.status);
                }
                return res.json();
            })
            .then(data => {
                console.log('è–ªèµ„æ•°æ®:', data);
                const chart = echarts.init(document.getElementById('salaryChart'));
                chart.setOption({
                    title: { text: 'å¹³å‡æœˆè–ª (å…ƒ)' },
                    tooltip: { trigger: 'axis' },
                    xAxis: { type: 'category', data: data.years },
                    yAxis: { type: 'value', name: 'æœˆè–ª(å…ƒ)' },
                    legend: { data: ['åç«¯å¼€å‘', 'å‰ç«¯å¼€å‘', 'å…¨æ ˆå¼€å‘', 'æ•°æ®ç§‘å­¦', 'AIå·¥ç¨‹å¸ˆ'] },
                    series: [
                        { name: 'åç«¯å¼€å‘', type: 'bar', data: data.backend },
                        { name: 'å‰ç«¯å¼€å‘', type: 'bar', data: data.frontend },
                        { name: 'å…¨æ ˆå¼€å‘', type: 'bar', data: data.fullstack },
                        { name: 'æ•°æ®ç§‘å­¦', type: 'bar', data: data.data_science },
                        { name: 'AIå·¥ç¨‹å¸ˆ', type: 'bar', data: data.ai_engineer }
                    ]
                });
                document.querySelector('.status').innerHTML += '<br>âœ… è–ªèµ„æ•°æ®åŠ è½½å®Œæˆ';
            })
            .catch(error => {
                console.error('è·å–è–ªèµ„æ•°æ®å¤±è´¥:', error);
                document.querySelector('.status').innerHTML += '<br>âŒ è–ªèµ„æ•°æ®åŠ è½½å¤±è´¥: ' + error.message;
            });
        
        // 3. è·å–è¯äº‘æ•°æ® - ä¿®æ­£URLæ‹¼å†™
        fetch(API_BASE + '/api/wordcloud')  // åŸæ¥æ˜¯ /api/worldoud
            .then(res => {
                console.log('è¯äº‘APIçŠ¶æ€ç :', res.status);
                if (!res.ok) {
                    throw new Error('è¯äº‘APIè¯·æ±‚å¤±è´¥: ' + res.status);
                }
                return res.json();
            })
            .then(data => {
                console.log('è¯äº‘æ•°æ®:', data);
                const chart = echarts.init(document.getElementById('wordcloudChart'));
                chart.setOption({
                    title: { text: 'çƒ­é—¨æŠ€æœ¯æ ˆè¯äº‘', left: 'center' },
                    tooltip: { show: true },
                    series: [{
                        type: 'wordCloud',
                        shape: 'circle',
                        sizeRange: [20, 80],
                        rotationRange: [-45, 45],
                        gridSize: 8,
                        drawOutOfBound: false,
                        textStyle: {
                            fontFamily: 'sans-serif',
                            fontWeight: 'bold',
                            color: function () {
                                return 'rgb(' + [
                                    Math.round(Math.random() * 160 + 50),
                                    Math.round(Math.random() * 160 + 50),
                                    Math.round(Math.random() * 160 + 50)
                                ].join(',') + ')';
                            }
                        },
                        data: data.data
                    }]
                });
                document.querySelector('.status').innerHTML += '<br>âœ… è¯äº‘æ•°æ®åŠ è½½å®Œæˆ';
            })
            .catch(error => {
                console.error('è·å–è¯äº‘æ•°æ®å¤±è´¥:', error);
                document.querySelector('.status').innerHTML += '<br>âŒ è¯äº‘æ•°æ®åŠ è½½å¤±è´¥: ' + error.message;
            });
        
        // 4. è·å–GitHubæŠ€æœ¯çƒ­åº¦æ•°æ®
        fetch(API_BASE + '/api/tech_heat')
            .then(res => {
                console.log('æŠ€æœ¯çƒ­åº¦APIçŠ¶æ€ç :', res.status);
                if (!res.ok) {
                    throw new Error('æŠ€æœ¯çƒ­åº¦APIè¯·æ±‚å¤±è´¥: ' + res.status);
                }
                return res.json();
            })
            .then(data => {
                console.log('æŠ€æœ¯çƒ­åº¦æ•°æ®:', data);
                const chart = echarts.init(document.getElementById('techHeatChart'));
                
                // å¤„ç†æ•°æ®
                const skills = data.data.map(item => item.skill);
                const heats = data.data.map(item => item.heat);
                
                chart.setOption({
                    title: { text: 'GitHubæŠ€æœ¯çƒ­åº¦æ’è¡Œ', left: 'center' },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: { type: 'shadow' }
                    },
                    xAxis: {
                        type: 'category',
                        data: skills,
                        axisLabel: {
                            rotate: 45,
                            interval: 0
                        }
                    },
                    yAxis: {type: 'value',name: 'çƒ­åº¦'},
                    series: [{name: 'çƒ­åº¦',type: 'bar',data: heats,
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#83bff6' },
                                { offset: 0.5, color: '#188df0' },
                                { offset: 1, color: '#188df0' }
                            ])}}]});
                document.querySelector('.status').innerHTML += '<br>âœ… æŠ€æœ¯çƒ­åº¦æ•°æ®åŠ è½½å®Œæˆ';
            })
            .catch(error => {
                console.error('è·å–æŠ€æœ¯çƒ­åº¦æ•°æ®å¤±è´¥:', error);
                document.querySelector('.status').innerHTML += '<br>âŒ æŠ€æœ¯çƒ­åº¦æ•°æ®åŠ è½½å¤±è´¥: ' + error.message;
            });
         function applyFilters() {
         const yearRange = document.getElementById('yearRange').value;
         const chartType = document.getElementById('chartType').value;
         const careerCheckboxes = document.querySelectorAll('input[name="career"]:checked');
         const selectedCareers = Array.from(document.querySelectorAll('input[name="career"]:checked')).map(cb => cb.value);
         console.log('åº”ç”¨ç­›é€‰:', { yearRange, chartType, selectedCareers });

         updateChartsWithFilters(selectedCareers,yearRange,chartType);
         document.getElementById('status').innerHTML = 'âœ… ç­›é€‰å·²åº”ç”¨';
        }
          
        function resetFilters() {
            document.getElementById('yearRange').value = '2020-2025';
            document.getElementById('chartType').value = 'line';
            document.querySelectorAll('input[name="career"]').forEach(cb => cb.checked = true);
            renderAllCharts();
            document.getElementById('status').innerHTML = 'âœ… ç­›é€‰å·²é‡ç½®';
        }
        
        function refreshData() {
            document.getElementById('status').innerHTML = 'ğŸ”„ æ­£åœ¨åˆ·æ–°æ•°æ®...';
            fetchAllData().then(() => {document.getElementById('status').innerHTML = 'âœ… æ•°æ®å·²åˆ·æ–°';});
        }

        function updateChartsWithFilters(careers, yearRange, chartType) {alert('æ­¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...\né€‰ä¸­çš„èŒä¸šï¼š${careers.join(', ')\nå¹´ä»½:$yearRange\n}');
        //TODO: æ ¹æ®ç­›é€‰æ¡ä»¶æ›´æ–°å›¾è¡¨æ•°æ®
        }

    </script>
</body>
</html>

