<template>
  <div>测试页面</div>
</template>
<template>
  <div style="padding: 20px; font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto;">
    <h1 style="color: #333;">前后端连接测试</h1>
    <p style="color: #666;">当前时间：{{ currentTime }}</p >
    
    <div style="margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
      <h2 style="margin-top: 0;">后端连接测试</h2>
      
      <div style="margin-bottom: 15px;">
        <strong>后端地址：</strong>
        <code>http://localhost:5000/api/test-connection</code>
      </div>
      
      <button 
        @click="testBackendConnection" 
        :disabled="testing"
        style="
          padding: 12px 24px;
          font-size: 16px;
          background-color: #007bff;
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
          transition: background-color 0.2s;
        "
        :style="{
          backgroundColor: testing ? '#6c757d' : '#007bff',
          cursor: testing ? 'not-allowed' : 'pointer'
        }"
      >
        {{ testing ? '测试中...' : '点击测试后端连接' }}
      </button>
      
      <button 
        @click="clearResults"
        style="
          padding: 12px 24px;
          font-size: 16px;
          background-color: #6c757d;
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
          margin-left: 10px;
        "
      >
        清除结果
      </button>
    </div>
    
    <!-- 结果显示区域 -->
    <div v-if="result" style="margin: 30px 0; padding: 20px; border-radius: 8px;" 
         :style="{
           backgroundColor: result.success ? '#d4edda' : '#f8d7da',
           border: result.success ? '1px solid #c3e6cb' : '1px solid #f5c6cb',
           color: result.success ? '#155724' : '#721c24'
         }">
      <h3 style="margin-top: 0;">
        {{ result.success ? '✅ 连接成功！' : '❌ 连接失败' }}
      </h3>
      
      <div v-if="result.data" style="margin-top: 15px;">
        <h4>返回数据：</h4>
        <pre style="
          background-color: white;
          padding: 15px;
          border-radius: 6px;
          overflow: auto;
          font-size: 14px;
          border: 1px solid #ddd;
        ">{{ JSON.stringify(result.data, null, 2) }}</pre>
      </div>
      
      <div v-if="result.error" style="margin-top: 15px;">
        <h4>错误信息：</h4>
        <div style="
          background-color: white;
          padding: 10px;
          border-radius: 4px;
          border: 1px solid #f5c6cb;
        ">{{ result.error }}</div>
      </div>
      
      <div v-if="result.responseTime !== undefined" style="margin-top: 10px; font-size: 14px;">
        <strong>响应时间：</strong> {{ result.responseTime }}ms
      </div>
    </div>
    
    <!-- 历史记录 -->
    <div v-if="history.length > 0" style="margin-top: 30px;">
      <h3>测试历史记录</h3>
      <div style="
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        max-height: 200px;
        overflow-y: auto;
      ">
        <div v-for="(item, index) in history" :key="index" 
             style="
               padding: 8px 0;
               border-bottom: 1px solid #ddd;
               display: flex;
               justify-content: space-between;
               align-items: center;
             ">
          <span>
            <span :style="{color: item.success ? 'green' : 'red'}">
              {{ item.success ? '✅' : '❌' }}
            </span>
            {{ formatTime(item.timestamp) }}
          </span>
          <span>
            响应: {{ item.responseTime }}ms
          </span>
        </div>
      </div>
    </div>
    
    <!-- 快速链接 -->
    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee;">
      <h3>快速测试链接</h3>
      <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
        <a 
          href=" " 
          target="_blank"
          style="
            padding: 8px 16px;
            background-color: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            display: inline-block;
          "
          @click.prevent="openLink('http://localhost:5000/api/health')"
        >
          测试后端健康检查
        </a >
        <a 
          href="http://localhost:5000/api/test-connection" 
          target="_blank"
          style="
            padding: 8px 16px;
            background-color: #17a2b8;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            display: inline-block;
          "
          @click.prevent="openLink('http://localhost:5000/api/test-connection')"
        >
          直接访问测试API
        </a >
        <a 
          href="http://localhost:5173" 
          style="
            padding: 8px 16px;
            background-color: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            display: inline-block;
          "
        >
          刷新前端页面
        </a >
      </div>
    </div>
    
    <!-- 调试信息 -->
    <div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 6px; font-size: 14px;">
      <h4 style="margin-top: 0;">调试信息</h4>
      <div><strong>前端地址：</strong> http://localhost:5173</div>
      <div><strong>后端地址：</strong> http://localhost:5000</div>
      <div><strong>当前状态：</strong> 
        <span v-if="testing">测试中...</span>
        <span v-else style="color: green;">就绪</span>
      </div>
      <div style="margin-top: 10px; color: #666;">
        提示：按 F12 打开浏览器开发者工具，查看 Console 和 Network 标签页获取详细信息
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: 'App',
  data() {
    return {
      currentTime: new Date().toLocaleString(),
      testing: false,
      result: null,
      history: []
    }
  },
  mounted() {
    // 更新当前时间
    setInterval(() => {
      this.currentTime = new Date().toLocaleString()
    }, 1000)
    
    // 尝试自动测试一次（可选）
    // setTimeout(() => {
    //   this.testBackendConnection()
    // }, 1000)
  },
  methods: {
    async testBackendConnection() {
      this.testing = true
      this.result = null
      
      const startTime = Date.now()
      
      try {
        console.log('开始测试后端连接...')
        const response = await fetch('http://localhost:5000/api/test-connection')
        const responseTime = Date.now() - startTime
        
        console.log('响应状态:', response.status, response.statusText)
        
        if (response.ok) {
          const data = await response.json()
          console.log('后端返回数据:', data)
          
          this.result = {
            success: true,
            data: data,
            responseTime: responseTime
          }
          
          this.addToHistory({
            success: true,
            timestamp: Date.now(),
            responseTime: responseTime
          })
          
        } else {
          throw new Error(`HTTP错误: ${response.status} ${response.statusText}`)
        }
        
      } catch (error) {
        const responseTime = Date.now() - startTime
        console.error('连接失败:', error)
        
        this.result = {
          success: false,
          error: error.message,
          responseTime: responseTime
        }
        
        this.addToHistory({
          success: false,
          timestamp: Date.now(),
          responseTime: responseTime,
          error: error.message
        })
        
      } finally {
        this.testing = false
      }
    },
    
    addToHistory(item) {
      // 添加到历史记录，最多保留10条
      this.history.unshift(item)
      if (this.history.length > 10) {
        this.history.pop()
      }
    },
    
    clearResults() {
      this.result = null
    },
    
    formatTime(timestamp) {
      const date = new Date(timestamp)
      return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}`
    },
    
    openLink(url) {
      window.open(url, '_blank')
    }
  }
}
</script>

<style>
/* 全局样式 */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  background-color: #f5f5f5;
}

/* 响应式设计 */
@media (max-width: 600px) {
  .container {
    padding: 10px;
  }
  
  button {
    width: 100%;
    margin-bottom: 10px;
  }
}
</style>